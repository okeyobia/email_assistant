## Email Assistant CLI

A Gmail-integrated command-line assistant that fetches unread messages, classifies them via keyword rules (and optional ML), and applies Gmail labels automatically.

### Key Features
- OAuth2 authentication with the Gmail API (google-auth, google-api-python-client)
- Fetch + inspect unread messages directly from the CLI
- Rule-based labeling with customizable keywords stored in `rules/rules.json`
- Optional ML classifier hook (scikit-learn pipeline or transformers model)
- Automatic label creation + caching
- Structured logging + local statistics tracking

### Project Layout
```
main.py              # Click-powered CLI entry point
services/            # Gmail API wrapper, auth, classifiers, stats store
utils/               # Config loader, logging config, rules engine
models/              # Typed data containers for emails + rules
rules/rules.json     # Default keyword rules
data/stats.json      # JSON stats file (autogenerated)
logs/                # Rotating log files (autogenerated)
```

### Requirements
- Python 3.11+
- uv (https://github.com/astral-sh/uv) for dependency & script management
- Gmail API enabled on a Google Cloud project with OAuth client credentials

### Setup
1. **Clone & enter the project**
	```bash
	git clone <repo-url> email_assistant
	cd email_assistant
	```

2. **Install dependencies**
	```bash
	uv sync           # installs core dependencies into .venv
	uv sync --all-extras  # optional: include the ML extras
	```

3. **Create OAuth credentials**
	- In Google Cloud Console, enable the Gmail API.
	- Create an OAuth 2.0 Client ID (Desktop) and download the JSON file.
	- Save it in the project root as `credentials.json` (or update `.env`).

4. **Configure environment variables**
	```bash
	cp .env.example .env
	# edit .env with your paths + desired defaults
	```

5. **Run an initial OAuth flow**
	```bash
	uv run email-assistant fetch
	```
	- A browser window will prompt you to authorize the Gmail scopes.
	- `token.json` will be generated and cached for future runs.

### CLI Usage
| Command | Description |
| --- | --- |
| `uv run email-assistant fetch --max-results 10` | Print a table of unread emails |
| `uv run email-assistant label --max-results 25` | Classify & label unread emails |
| `uv run email-assistant create-label "Finance"` | Ensure a label exists in Gmail |
| `uv run email-assistant stats` | Show local action counters |

Use `--env-file custom.env` on any command to point to a different configuration file.

### Custom Rules & ML
- Edit `rules/rules.json` to add or adjust keyword-based label rules. Each rule supports:
  ```json
  {
	 "label": "Work",
	 "keywords": ["deadline", "client"],
	 "match_subject": true,
	 "match_body": true,
	 "priority": 4
  }
  ```
- Optional ML: provide either
  - `ML_MODEL_PATH` pointing to a scikit-learn pipeline saved via `joblib.dump`
  - `TRANSFORMER_MODEL_NAME` referencing a Hugging Face text-classification pipeline
- Install ML extras with `uv sync --extra ml` (or `uv sync --all-extras`).

### Logging & Statistics
- Logs live under `logs/email_assistant.log` (rotating file + console output).
- Local stats live in `data/stats.json` and track how many messages were fetched or labeled plus per-label counts.

### Tips
- Run `uv run email-assistant label` via cron or a scheduler for continuous triage.
- Keep your `.env`, `credentials.json`, and `token.json` out of version control.
